#!/bin/bash

NMAP_DIR=/var/log/nmap

if [ ! -d "$NMAP_DIR" ]; then
    mkdir "$NMAP_DIR"
fi

NMAP_LOG="$NAMP_DIR/nmap.log"

if [ ! -f "$NMAP_LOG" ]; then
    touch "$NMAP_LOG"
fi

sudo nmap -sP -oG - 192.168.1.* \
| tee -a "$NMAP_LOG" \
| grep -oE '((1?[0-9][0-9]?|2[0-4][0-9]|25[0-5])\.){3}(1?[0-9][0-9]?|2[0-4][0-9]|25[0-5])' \
| while read addr
do

  OUTPUT=${NMAP_DIR}/nmap_${addr}_log
  #echo Output=${OUTPUT}
  if [ ! -f ${OUTPUT} ]; then
     touch ${OUTPUT}
  fi
  echo Seen `date +"%Y-%m-%d %T"` >> ${OUTPUT}

done


